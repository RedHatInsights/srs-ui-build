"use strict";(self.webpackChunksrs_ui=self.webpackChunksrs_ui||[]).push([[483],{9483:(e,t,i)=>{i.r(t),i.d(t,{CreateServiceRegistry:()=>v,default:()=>h});var a=i(70655),s=i(85893),r=i(93264),n=i(3669),l=i(89528);class o{constructor(){this.name="",this.description=""}}var d=i(180),c=i(15847),u=i(18377),m=i(97644);const _=({quota:e,hasServiceRegistryCreationFailed:t,loadingQuota:i,hasUserTrialInstance:a})=>{const{t:r}=(0,c.useTranslation)("service-registry"),{data:l,isServiceDown:o}=e||{},d=null==l?void 0:l.get(null===m.QuotaType||void 0===m.QuotaType?void 0:m.QuotaType.srs);if(void 0===e||i)return(0,s.jsx)(n.Alert,{className:"pf-u-mb-md",variant:n.AlertVariant.info,title:r("instance_checking_message"),"aria-live":"polite",isInline:!0,customIcon:(0,s.jsx)(n.Spinner,{size:"md","aria-valuetext":"Checking service registry availability"})});let u="",_="",g=n.AlertVariant.danger;return!d&&a?(u="trial_service_registry_title",g=n.AlertVariant.warning,_="deploy_one_instance_alert_message"):d||a?d&&0===(null==d?void 0:d.remaining)&&(g=n.AlertVariant.warning,u="standard_service_registry_alert_title",_="standard_service_registry_alert_message"):(g=n.AlertVariant.info,u="trial_quota_service_registry_title"),t&&(g=n.AlertVariant.danger,u="service_registry_creation_failed_alert_title",_=d?"standard_service_registry_creation_failed_alert_message":"trial_service_registry_creation_failed_alert_message"),o&&(u="common:something_went_wrong",g=n.AlertVariant.danger,_="ams_service_down_message"),(0,s.jsx)(s.Fragment,{children:u&&(0,s.jsx)(n.Alert,Object.assign({className:"pf-u-mb-md",variant:g,title:r(u),"aria-live":"polite",isInline:!0},{children:r(_)}))})};var g=i(10069);const x=({isSrsTrial:e})=>{const{t}=(0,c.useTranslation)("service-registry"),i=(0,r.useContext)(g.QuickStartContext);return(0,s.jsxs)(n.TextContent,{children:[(0,s.jsx)(n.Text,Object.assign({component:n.TextVariants.h3},{children:t("common:instance_information")})),(0,s.jsxs)(n.TextList,Object.assign({component:n.TextListVariants.dl},{children:[(0,s.jsxs)(n.Grid,Object.assign({sm:6,lg:12,hasGutter:!0},{children:[e&&(0,s.jsxs)(n.GridItem,{children:[(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dt},{children:t("common:duration")})),(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dd},{children:t("common:duration_value")}))]}),(0,s.jsxs)(n.GridItem,{children:[(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dt},{children:t("artifact_versions")})),(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dd},{children:t("artifact_versions_value")}))]}),(0,s.jsxs)(n.GridItem,{children:[(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dt},{children:t("artifact_size")})),(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dd},{children:t("artifact_size_value")}))]}),(0,s.jsxs)(n.GridItem,{children:[(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dt},{children:t("request_rate")})),(0,s.jsx)(n.TextListItem,Object.assign({component:n.TextListItemVariants.dd},{children:t("request_rate_value")}))]})]})),(0,s.jsx)(n.Button,Object.assign({isSmall:!0,isInline:!0,variant:n.ButtonVariant.link,style:{marginTop:"20px"},onClick:()=>i.setActiveQuickStart&&i.setActiveQuickStart("getting-started-service-registry")},{children:t("common:quick_start_guide_message")}))]}))]})},v=({fetchServiceRegistries:e,hasUserTrialInstance:t,hideModal:i})=>{var g;const v=(0,r.useMemo)((()=>new o),[]),{t:h}=(0,c.useTranslation)(["service-registry","common"]),f=(0,m.useAuth)(),{srs:{apiBasePath:j}}=(0,m.useConfig)(),{addAlert:T}=(0,m.useAlert)()||{},{getQuota:p}=(0,m.useQuota)()||{},[I,S]=(0,r.useState)({fieldState:"default"}),[b,y]=(0,r.useState)(v),[C,A]=(0,r.useState)(!0),[O,L]=(0,r.useState)(!1),[k,V]=(0,r.useState)(),[w,F]=(0,r.useState)(!1),Q=null===(g=null==k?void 0:k.data)||void 0===g?void 0:g.get(null===m.QuotaType||void 0===m.QuotaType?void 0:m.QuotaType.srs),R=void 0===(null==k?void 0:k.loading)||(null==k?void 0:k.loading),N=!Q,E=R||t||w||Q&&0===(null==Q?void 0:Q.remaining),q=(0,r.useCallback)((()=>{S({fieldState:"default"}),y(v),A(!0)}),[v]),z=(0,r.useCallback)((()=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){p&&(yield p().then((e=>{V(e)})))}))),[p]);(0,r.useEffect)((()=>{z()}),[z]),(0,r.useEffect)((()=>{"error"!==I.fieldState&&A(!0)}),[I]);const U=e=>{y(Object.assign(Object.assign({},b),{name:e}));let t=!0;e&&!/^[a-z]([-a-z0-9]*[a-z0-9])?$/.test(e.trim())&&(t=!1),e&&e.length>u.xe?S({fieldState:"error",message:h("service_registry_name_length_is_greater_than_expected",{maxLength:u.xe})}):t&&"error"===I.fieldState?S({fieldState:"default",message:""}):t||S({fieldState:"error",message:h("input_filed_invalid_helper_text")})},D=(0,r.useCallback)((e=>{var t,i;let a,s;(0,u.G6)(e)&&(a=null===(t=e.response)||void 0===t?void 0:t.data.reason,s=null===(i=e.response)||void 0===i?void 0:i.data.code),s===u.SM.FAILED_TO_CHECK_QUOTA||s===u.SM.USER_ALREADY_HAVE_TRIAL_INSTANCE||s===u.SM.INSUFFICIENT_QUOTA||s===u.SM.INSUFFICIENT_STANDARD_QUOTA?F(!0):T&&T({title:h("something_went_wrong"),variant:m.AlertVariant.danger,description:a})}),[T,h]),G=(0,r.useCallback)((()=>{let e=!0;const{name:t}=b;return t&&""!==t.trim()?/^[a-z]([-a-z0-9]*[a-z0-9])?$/.test(t.trim())||(e=!1,S({fieldState:"error",message:h("input_filed_invalid_helper_text")})):(e=!1,S({fieldState:"error",message:h("common:this_is_a_required_field")})),t.length>u.xe&&(e=!1,S({fieldState:"error",message:h("service_registry_name_length_is_greater_than_expected",{maxLength:u.xe})})),e}),[b,h]),M=(0,r.useCallback)((()=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const t=G(),a=yield null==f?void 0:f.srs.getToken();if(t){if(a){const t=new l.RegistriesApi(new l.Configuration({accessToken:a,basePath:j}));try{L(!0),yield t.createRegistry({name:b.name}).then((()=>{i(),q(),e&&e(),L(!1)}))}catch(e){L(!1),D(e)}}}else A(!1)}))),[i,null==f?void 0:f.srs,j,e,D,q,G,b]),B=(0,r.useCallback)((()=>{q(),i()}),[q,i]),P=(0,r.useCallback)((e=>{e.preventDefault(),M()}),[M]);return(0,s.jsxs)(d.a$,Object.assign({id:"modalCreateSRegistry",isModalOpen:!0,title:h("create_service_registry_instance"),handleModalToggle:B,onCreate:M,isFormValid:C,primaryButtonTitle:"Create",isCreationInProgress:O,dataTestIdSubmit:"modalCreateServiceRegistry-buttonSubmit",dataTestIdCancel:"modalCreateServiceRegistry-buttonCancel",isDisabledButton:E},{children:[(0,s.jsx)(_,{quota:k,hasServiceRegistryCreationFailed:w,loadingQuota:R,hasUserTrialInstance:t}),(0,s.jsxs)(n.Flex,Object.assign({direction:{default:"column",lg:"row"}},{children:[(0,s.jsxs)(n.FlexItem,Object.assign({flex:{default:"flex_2"}},{children:[" ",(0,s.jsx)((()=>{const{message:e,fieldState:t}=I,{name:i}=b;return(0,s.jsxs)(n.Form,Object.assign({onSubmit:P},{children:[!C&&(0,s.jsx)(n.FormAlert,{children:(0,s.jsx)(n.Alert,{variant:"danger",title:h("common:form_invalid_alert"),"aria-live":"polite",isInline:!0})}),(0,s.jsx)(n.FormGroup,Object.assign({label:"Name",isRequired:!0,fieldId:"text-input-name",helperTextInvalid:e,validated:t,helperText:h("input_filed_invalid_helper_text")},{children:(0,s.jsx)(n.TextInput,{isRequired:!0,type:"text",id:"text-input-name",name:"text-input-name",value:i,onChange:U,validated:t,autoFocus:!0})}))]}))}),{})]})),(0,s.jsx)(n.Divider,{isVertical:!0}),(0,s.jsx)(n.FlexItem,Object.assign({flex:{default:"flex_1"},className:"mk--create-instance-modal__sidebar--content"},{children:(0,s.jsx)(x,{isSrsTrial:N})}))]}))]}))},h=v}}]);
//# sourceMappingURL=483.d70a480a.js.map
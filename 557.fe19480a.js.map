{"version":3,"file":"557.fe19480a.js","mappings":"0QA+BA,MAAMA,EAEF,EACFC,QAAQ,GACRC,qBACAC,SACAC,WACAC,yBACAC,iBACAC,0BACAC,gBAEA,MAAM,EAAEC,IAAM,IAAAC,gBAAe,CAAC,mBAAoB,YAC5C,SAAEC,IAAa,IAAAC,YACfC,GAAU,IAAAC,cACVC,GAAO,IAAAC,YAEXC,KAAOC,YAAaC,KAClB,IAAAC,aACEC,GAAW,IAAAC,eACXC,EAAuBnB,aAAQ,EAARA,EAAUoB,MAEhCC,EAAmBC,IAAwB,IAAAC,aAC3CC,EAASC,IAAc,IAAAF,WAAkB,IAEzCG,EAAcC,IAAmB,IAAAJ,WAAkB,IAMnDK,EAAWC,IAAgB,IAAAN,WAAkB,GAU9CO,EAA0B,KAC1B/B,aAAM,EAANA,EAAQgC,iBAAkB,EAAAC,oBAAoBC,SAE9CZ,aAAiB,EAAjBA,EAAmBU,kBACjBZ,aAAoB,EAApBA,EAAsBY,iBACxBH,GAeAM,EAAe,KACnBZ,EAAqB,IACrBlB,GAAW,EAeP+B,EAAwBnC,IAAuB,iDACnD,MAAM,GAAEoC,EAAE,KAAEhB,GAASpB,EACfqC,QAAoB1B,aAAI,EAAJA,EAAME,IAAIyB,WACpC,GAAIF,EAAI,CACNX,GAAW,GACX,MAAMc,EAAM,IAAI,EAAAC,cACd,IAAI,EAAAC,cAAc,CAChBJ,cACAtB,oBAIEwB,EACHJ,eAAeC,GACfM,MAAK,KACJjB,GAAW,GACXlB,EAAS,CACPV,MAAOQ,EAAE,4CAA6C,CAAEe,SACxDuB,QAAS,EAAAC,aAAaC,UAEpB3C,EACFO,EAAQqC,KAAK7B,EAAS8B,eAEtB9C,GAA0BA,IAE5BiC,GAAc,IAEfc,OAAOC,IACNxB,GAAW,GAxCO,CAACwB,I,MACzB,IAAIC,GACA,QAAkBD,KACpBC,EAAwB,QAAd,EAAAD,EAAME,gBAAQ,eAAEC,KAAKC,QAEjC9C,EAAS,CACPV,MAAOQ,EAAE,+BACTsC,QAAS,EAAAC,aAAaU,OACtBC,YAAaL,GACb,EAgCIM,CAAkBP,EAAM,G,CAGhC,IAEMM,GACJ,iCACE,SAAC,EAAAE,YAAW,eAACC,UAAU,yBAAuB,WAC5C,SAAC,EAAAC,KAAI,eAACC,UAAW,EAAAC,aAAaC,GAAC,WAC7B,iBACEC,wBAAyB,CACvBC,OAAQ3D,EAAE,sCAAuC,CAC/Ce,KAAMD,cAMhB,SAAC,EAAA8C,MAAK,eACJtB,QAAQ,OACRuB,UAAQ,EACRR,UAAU,aACV7D,MAAOQ,EAAE,gCACT8D,aACE,SAAC,EAAAC,gBAAe,eAACC,QAxGD,KACtB1C,GAAgB,EAAK,GAuG0B,UACtCxB,GACCH,GACAG,EAAwBH,EAAUK,EAAE,2BACtB,UAGnBA,EAAE,oCAKT,OACE,SAAC,KAAc,CACbiE,aAAa,EACbzE,MAAOA,EACPC,mBAAkB,6BAChByE,WAAYzC,IACZ,cAAe,oCACZhC,GAAkB,CACrBuE,QAASlC,EACTqC,UAAWhD,IAEbiD,kBAAmBvC,EACnBwC,UAAWnB,EACXoB,iBAAkB3E,EAClB4E,eAAgB,CACdC,eAAe9E,aAAM,EAANA,EAAQgC,iBAAkB,EAAAC,oBAAoBC,MAC7D6C,MAAOzE,EAAE,8BAA+B,CACtCe,KAAMD,IAER4D,MAAO1D,EACP2D,SA9HsBD,IAC1BzD,EAAqByD,EAAM,EA8HvBE,WA7G4CC,IAC9B,UAAdA,EAAMC,MAAoBrD,KAA6B9B,GACzDmC,EAAenC,E,EA4GboF,WAAW,GAEbC,cAAe,CACbjD,GAAI,WACJV,aAAcA,EACdE,UAAWA,EACXoD,SA1ImB,KACvBnD,GAAcD,EAAU,IA4IzB,EAIH,G","sources":["webpack://srs-ui/./src/ServiceRegistry/dialogs/DeleteServiceRegistry/DeleteServiceRegistry.tsx"],"sourcesContent":["import { useState, FunctionComponent } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport {\n  TextContent,\n  Text,\n  TextVariants,\n  Alert,\n  AlertActionLink,\n  TextInputProps,\n} from '@patternfly/react-core';\nimport {\n  Registry,\n  RegistriesApi,\n  Configuration,\n  RegistryStatusValue,\n} from '@rhoas/registry-management-sdk';\nimport {\n  useAuth,\n  useConfig,\n  useBasename,\n  useAlert,\n  AlertVariant,\n} from '@rhoas/app-services-ui-shared';\nimport {\n  MASDeleteModal,\n  BaseModalProps,\n  DeleteServiceRegistryProps,\n} from '@app/components';\nimport { isServiceApiError } from '@app/utils';\n\nconst DeleteServiceRegistry: FunctionComponent<\n  BaseModalProps & DeleteServiceRegistryProps\n> = ({\n  title = '',\n  confirmButtonProps,\n  status,\n  registry,\n  fetchServiceRegistries,\n  shouldRedirect,\n  renderDownloadArtifacts,\n  hideModal,\n}) => {\n  const { t } = useTranslation(['service-registry', 'common']);\n  const { addAlert } = useAlert();\n  const history = useHistory();\n  const auth = useAuth();\n  const {\n    srs: { apiBasePath: basePath },\n  } = useConfig();\n  const basename = useBasename();\n  const selectedInstanceName = registry?.name;\n\n  const [instanceNameInput, setInstanceNameInput] = useState<string>();\n  const [loading, setLoading] = useState<boolean>(false);\n\n  const [isDownloaded, setIsDownloaded] = useState<boolean>(false);\n\n  const onClickDownload = () => {\n    setIsDownloaded(true);\n  };\n\n  const [isChecked, setIsChecked] = useState<boolean>(false);\n\n  const onChangeCheckbox = () => {\n    setIsChecked(!isChecked);\n  };\n\n  const handleInstanceName = (value: string) => {\n    setInstanceNameInput(value);\n  };\n\n  const isConfirmButtonDisabled = () => {\n    if (status?.toLowerCase() === RegistryStatusValue.Ready) {\n      if (\n        instanceNameInput?.toLowerCase() ===\n          selectedInstanceName?.toLowerCase() &&\n        isChecked\n      ) {\n        return false;\n      }\n      return true;\n    }\n    return false;\n  };\n\n  const onKeyPress: TextInputProps['onKeyPress'] = (event) => {\n    if (event.key === 'Enter' && !isConfirmButtonDisabled() && registry) {\n      deleteRegistry(registry);\n    }\n  };\n\n  const handleToggle = () => {\n    setInstanceNameInput('');\n    hideModal();\n  };\n\n  const handleServerError = (error: Error) => {\n    let message: string | undefined;\n    if (isServiceApiError(error)) {\n      message = error.response?.data.reason;\n    }\n    addAlert({\n      title: t('common:something_went_wrong'),\n      variant: AlertVariant.danger,\n      description: message,\n    });\n  };\n\n  const deleteRegistry = async (registry: Registry) => {\n    const { id, name } = registry;\n    const accessToken = await auth?.srs.getToken();\n    if (id) {\n      setLoading(true);\n      const api = new RegistriesApi(\n        new Configuration({\n          accessToken,\n          basePath,\n        })\n      );\n\n      await api\n        .deleteRegistry(id)\n        .then(() => {\n          setLoading(false);\n          addAlert({\n            title: t('service_registry_deletion_success_message', { name }),\n            variant: AlertVariant.success,\n          });\n          if (shouldRedirect) {\n            history.push(basename.getBasename());\n          } else {\n            fetchServiceRegistries && fetchServiceRegistries();\n          }\n          handleToggle();\n        })\n        .catch((error) => {\n          setLoading(false);\n          handleServerError(error);\n        });\n    }\n  };\n\n  const description = (\n    <>\n      <TextContent className='pf-u-mb-md pf-u-mb-xs'>\n        <Text component={TextVariants.p}>\n          <span\n            dangerouslySetInnerHTML={{\n              __html: t('delete_service_registry_description', {\n                name: selectedInstanceName,\n              }),\n            }}\n          />\n        </Text>\n      </TextContent>\n      <Alert\n        variant='info'\n        isInline\n        className='pf-u-mb-lg'\n        title={t('delete_instance_alert_header')}\n        actionLinks={\n          <AlertActionLink onClick={onClickDownload}>\n            {renderDownloadArtifacts &&\n              registry &&\n              renderDownloadArtifacts(registry, t('download_artifacts'))}\n          </AlertActionLink>\n        }\n      >\n        {t('delete_instance_alert_body')}\n      </Alert>\n    </>\n  );\n\n  return (\n    <MASDeleteModal\n      isModalOpen={true}\n      title={title}\n      confirmButtonProps={{\n        isDisabled: isConfirmButtonDisabled(),\n        'data-testid': 'modalDeleteRegistry-buttonDelete',\n        ...confirmButtonProps,\n        onClick: deleteRegistry,\n        isLoading: loading,\n      }}\n      handleModalToggle={handleToggle}\n      textProps={description}\n      selectedItemData={registry}\n      textInputProps={{\n        showTextInput: status?.toLowerCase() === RegistryStatusValue.Ready,\n        label: t('service_registry_name_label', {\n          name: selectedInstanceName,\n        }),\n        value: instanceNameInput,\n        onChange: handleInstanceName,\n        onKeyPress,\n        autoFocus: true,\n      }}\n      checkboxProps={{\n        id: 'checkbox',\n        isDownloaded: isDownloaded,\n        isChecked: isChecked,\n        onChange: onChangeCheckbox,\n      }}\n    ></MASDeleteModal>\n  );\n};\n\nexport { DeleteServiceRegistry };\nexport default DeleteServiceRegistry;\n"],"names":["DeleteServiceRegistry","title","confirmButtonProps","status","registry","fetchServiceRegistries","shouldRedirect","renderDownloadArtifacts","hideModal","t","useTranslation","addAlert","useAlert","history","useHistory","auth","useAuth","srs","apiBasePath","basePath","useConfig","basename","useBasename","selectedInstanceName","name","instanceNameInput","setInstanceNameInput","useState","loading","setLoading","isDownloaded","setIsDownloaded","isChecked","setIsChecked","isConfirmButtonDisabled","toLowerCase","RegistryStatusValue","Ready","handleToggle","deleteRegistry","id","accessToken","getToken","api","RegistriesApi","Configuration","then","variant","AlertVariant","success","push","getBasename","catch","error","message","response","data","reason","danger","description","handleServerError","TextContent","className","Text","component","TextVariants","p","dangerouslySetInnerHTML","__html","Alert","isInline","actionLinks","AlertActionLink","onClick","isModalOpen","isDisabled","isLoading","handleModalToggle","textProps","selectedItemData","textInputProps","showTextInput","label","value","onChange","onKeyPress","event","key","autoFocus","checkboxProps"],"sourceRoot":""}